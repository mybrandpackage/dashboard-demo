import{x as ee,T as be,o,A as b,z as T,l as f,r as y,i as v,a as k,Y as ke,b as a,t as g,d as L,G as U,C as R,F as B,E as X,D as $e,as as Oe,W as oe,at as Ve,V as ie,B as ue,_ as ce,H as ne,I as xe,J as Te,U as Ne,au as we,ab as je,c as Be,v as Fe}from"./vuetify-a54d7e62.js";import{a as D,u as W,c as He}from"./index-ec06e4d1.js";import{a as Ke,R as Ge,_ as Ye}from"./PortalLayout-45839c66.js";import{b as We,I as Je,u as Xe,c as Qe,a as Ze}from"./ServiceRestrictionIllustration-157ed40f.js";import{t as P}from"./service-mixins-d1b95a8a.js";import{c as et,a as tt,b as st,d as at,p as rt,i as lt,u as ot,R as nt,T as ve}from"./TicketEntry-82c99ab7.js";import{i as H,z as N,A as Q,k as F,B as it,v as Se,j as ut,r as _e,C as de,s as ct,n as fe,t as ye}from"./snackbar-store-09a12cd9.js";import{V as me,a as dt}from"./purify.es-48fd10f6.js";import{V as Ae,f as mt,e as pt,s as wt}from"./date-helpers-c645abed.js";import{V as vt}from"./VDatePicker-a9f94075.js";import{_ as Z}from"./SpiceworksButton-9aecd653.js";import{V as Ce}from"./VForm-d7fecbe6.js";import"./FullFooter-b8e9b5b2.js";import"./VContainer-adb714d9.js";import"./VMain-64ef65e5.js";import"./app-config-store-3dc0ddd6.js";const _t={__name:"PortalView",setup(e){const s=()=>{const t=document.documentElement.clientHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`)};return ee(s),(t,u)=>{const r=be("router-view");return o(),b(Ke,{onSetViewportHeight:s},{default:T(()=>[f(r)]),_:1})}}};D.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('[name="csrf-token"]').content;async function ft(e){const s=`/api/portal/settings/${e}`;try{const t=await D.get(s);return P(t.data)}catch(t){if(t.response)return t.response.data}}async function yt(e){const s=`/api/portal/end_users/${e}`;try{const t=await D.get(s);return P(t.data)}catch(t){if(t.response)return t.response.data}}async function ht(){const e="/api/portal/custom_attributes";try{const s=await D.get(e);return P(s.data)}catch(s){if(s.response)return s.response.data}}async function gt(e){const s="/api/portal/tickets";try{const t=await D.post(s,e);return P(t.data)}catch(t){if(t.response)return t.response.data}}async function bt(e="open"){const s=`/api/portal/tickets?view=${e}`;try{const t=await D.get(s);return P(t.data.tickets)}catch(t){if(t.response)return t.response.data}}async function kt(e){const s=`/api/portal/tickets/${e}`;try{const t=await D.get(s);return P(t.data.portal_ticket)}catch(t){if(t.response)return t.response.data}}async function $t(e){const s=`/api/portal/tickets/${e.ticket.number}`;try{const t=await D.put(s,e);return P(t.data.portal_ticket)}catch(t){if(t.response)return t.response.data}}async function Vt(e){const s=`/api/portal/tickets/${e}/ticket_comments`;try{const t=await D.get(s);return P(t.data.ticket_comments)}catch(t){if(t.response)return t.response.data}}async function xt(e,s){const t=`/api/portal/tickets/${e}/ticket_comments`;try{const u=await D.post(t,s);return P(u.data.comment)}catch(u){if(u.response)return u.response.data}}const Ee={plugins:[],state:{gRecaptchaSiteKey:"",portalSettings:null,portalCustomAttributes:[],currentUser:null,portalServiceInterruption:!1,...et()},mutations:{SET_G_RECAPTCHA_SITE_KEY(e,s){e.gRecaptchaSiteKey=s},SET_PORTAL_SETTINGS(e,s){e.portalSettings=s},SET_PORTAL_CUSTOM_ATTRIBUTES(e,s){e.portalCustomAttributes=s},SET_CURRENT_USER(e,s){e.currentUser=s},SET_PORTAL_SERVICE_INTERRUPTION(e,s){e.portalServiceInterruption=s},...tt()},actions:{async setPortalData(e,s){const{portalSetting:t,ticketCategories:u}=await ft(s),{customAttributes:r}=await ht();if(e.commit("SET_PORTAL_SETTINGS",t||{}),e.commit("SET_TICKET_CATEGORIES",u||[]),e.commit("SET_PORTAL_CUSTOM_ATTRIBUTES",r||[]),t.currentUser){const{endUser:c}=await yt(t.currentUser.id);e.commit("SET_CURRENT_USER",c)}},setGRecaptchaSiteKey(e,s){e.commit("SET_G_RECAPTCHA_SITE_KEY",s)},setPortalServiceInterruption(e,s){e.commit("SET_PORTAL_SERVICE_INTERRUPTION",s)},...st()},modules:{},getters:{...at()}},Tt={__name:"CustomAttributeTextArea",props:{modelValue:{type:void 0,required:!0}},emits:["update:modelValue"],setup(e,{emit:s}){const t=e,u=s,r=y({...t.modelValue}),c=v({get:()=>r.value.value,set:l=>{r.value={...r.value,value:l},u("update:modelValue",r.value)}}),m={value:{required:N(()=>r.value.required),maxLength:Q(2e3)}},p=H(m,r),_=v(()=>p.value.$error?Object.values(p.value.$errors).map(l=>l.$message):[]),d=l=>l.required?`${l.name} (required)`:l.name;return(l,n)=>(o(),b(me,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value=i),counter:2e3,label:d(r.value),"error-messages":_.value},null,8,["modelValue","label","error-messages"]))}},he={__name:"CustomAttributeTextField",props:{modelValue:{type:void 0,required:!0},isNumber:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:s}){const t=e,u=s,r=y({...t.modelValue}),c=v({get:()=>r.value.value,set:l=>{r.value={...t.modelValue,value:l},u("update:modelValue",r.value)}}),m={value:{required:N((l,n)=>n.required),maxLength:Q(255)}},p=H(m,r),_=v(()=>p.value.$error?Object.values(p.value.$errors).map(l=>l.$message):[]),d=l=>l.required?`${l.name} (required)`:l.name;return(l,n)=>(o(),b(F,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value=i),counter:e.isNumber?void 0:255,label:d(e.modelValue),"error-messages":_.value,type:e.isNumber?"number":"text"},null,8,["modelValue","counter","label","error-messages","type"]))}},St={__name:"CustomAttributeList",props:{modelValue:{type:void 0,required:!0}},emits:["update:modelValue"],setup(e,{emit:s}){const t=e,u=s,r=y({...t.modelValue}),c=v({get:()=>r.value.value,set:l=>{r.value={...t.modelValue,value:l},u("update:modelValue",r.value)}}),m=l=>l.required?`${l.name} (required)`:l.name,p={value:{required:N((l,n)=>n.required)}},_=H(p,r),d=v(()=>_.value.$error?Object.values(_.value.$errors).map(l=>l.$message):[]);return(l,n)=>(o(),k("div",null,[f(Ae,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value=i),items:r.value.options,label:m(e.modelValue),"error-messages":d.value},null,8,["modelValue","items","label","error-messages"])]))}},At={__name:"CustomAttributePhoneNumber",props:{modelValue:{type:void 0,required:!0}},emits:["update:modelValue"],setup(e,{emit:s}){const t=e,u=s,r=y({...t.modelValue}),c=v({get:()=>r.value.value,set:l=>{r.value={...t.modelValue,value:l},u("update:modelValue",r.value)}}),m={value:{required:N((l,n)=>n.required),isValidPhoneNumber:it.withMessage(rt,()=>lt(c.value))}},p=H(m,r),_=v(()=>p.value.$error?Object.values(p.value.$errors).map(l=>l.$message):[]),d=l=>l.required?`${l.name} (required)`:l.name;return(l,n)=>(o(),b(F,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=i=>c.value=i),label:d(e.modelValue),"error-messages":_.value},null,8,["modelValue","label","error-messages"]))}},Ct={__name:"CustomAttributeDatePicker",props:{modelValue:{type:void 0,required:!0}},emits:["update:modelValue"],setup(e,{emit:s}){const t=e,u=s,r=y({...t.modelValue}),c=y(!1),m=v({get:()=>r.value.value?new Date(r.value.value):null,set:i=>{r.value={...t.modelValue,value:i},u("update:modelValue",r.value)}}),p={value:{required:N((i,C)=>C.required)}},_=H(p,r),d=v(()=>_.value.$error?Object.values(_.value.$errors).map(i=>i.$message):[]),l=i=>i.required?`${i.name} (required)`:i.name,n=i=>{m.value=mt(i,"yyyy-MM-dd"),c.value=!1};return(i,C)=>(o(),b(Se,{"model-value":c.value,"close-on-content-click":!1,transition:"scale-transition","min-width":"auto","onUpdate:modelValue":C[1]||(C[1]=$=>c.value=$)},{activator:T(({props:$})=>[f(F,ke({"model-value":r.value.value},$,{label:l(e.modelValue),"error-messages":d.value,"prepend-inner-icon":"mdi-calendar",readonly:"",clearable:"","onClick:clear":C[0]||(C[0]=S=>m.value=null)}),null,16,["model-value","label","error-messages"])]),default:T(()=>[f(vt,{"model-value":m.value,"onUpdate:modelValue":n},null,8,["model-value"])]),_:1},8,["model-value"]))}};const Et={class:"tw-w-full tw-rounded tw-border tw-bg-white tw-shadow-portal"},Ut={class:"tw-p-4 sm:tw-p-6"},qt={class:"tw-mb-1 tw-text-xl tw-font-bold"},It={class:"tw-text-sm"},Rt={key:0},Lt=["href"],Dt=a("hr",null,null,-1),Mt={key:2,class:"tw-w-64"},Pt={class:"tw-mt-2 tw-flex tw-flex-row"},Ue={__name:"TicketForm",setup(e){const s=W(),t=y(""),u=y(null),r=y(""),c=y(""),m=y(""),p=y([]),_=y(!1),d=v(()=>s.state.currentUser),l=v(()=>({email:{required:N(()=>!d.value),emailValidator:ut},summary:{required:_e,maxLength:Q(255)},description:{required:_e,maxLength:Q(2e3)},categoryId:{required:N(()=>s.state.portalSettings.requireCategory)}})),n=H(l,{email:t,summary:r,description:c,categoryId:m}),i=v(()=>s.state.gRecaptchaSiteKey),C=v(()=>s.state.ticketCategories),$=v(()=>s.state.portalSettings),S=v(()=>d.value),V=v(()=>$.value.requireCategory?"Category (required)":"Category"),K=v(()=>p.value.some(q=>q.uploading===!0)),G=s.dispatch.bind(s,"showSnackbar"),E=v(()=>s.state.portalCustomAttributes.map(h=>({value:null,ticketId:null,customAttributeId:h.id,customAttributeType:h.attrType,required:h.requiredInPortal,options:h.attrOptions,name:h.name})).sort((h,w)=>h.customAttributeId>w.customAttributeId?1:-1)),J=y(null),te=v(()=>{if(n.value.email.$error){if(n.value.email.required.$invalid)return["Email is required."];if(n.value.email.emailValidator.$invalid)return["Email must be valid."]}return[]}),se=v(()=>{if(n.value.summary.$dirty){if(n.value.summary.required.$invalid)return["Summary is required."];if(n.value.summary.maxLength.$invalid)return["Summary must be at most 255 characters long."]}return[]}),ae=v(()=>{if(n.value.description.$dirty){if(n.value.description.required.$invalid)return["Description is required."];if(n.value.description.maxLength.$invalid)return["Description must be at most 2000 characters long."]}return[]}),I=v(()=>n.value.categoryId.$error&&n.value.categoryId.required.$invalid?["Category is required."]:[]),M=y(null);async function re(q){_.value=!0;const h=E.value.map(Y=>({value:Y.value,ticket_id:Y.ticketId,custom_attribute_id:Y.customAttributeId,custom_attribute_type:Y.customAttributeType})),w={ticket:{creator:{email:t.value,avatar_url:""},summary:r.value,initial_upload_ids:Array.from(p.value,Y=>Y.signedId),description:c.value,ticket_category_id:m.value,custom_values:h},"g-recaptcha-response":q},x=await gt(w);_.value=!1;const j={display:!0,type:"success",message:[$.value.successTitle,$.value.successMessage].join(" ").trim()||"Your ticket has been submitted!"};x.errors?(j.type="error",j.message=x.errors):(J.value.reset(),M.value.reset(),n.value.$reset(),p.value=[]),G(j)}function O(){n.value.$touch(),n.value.$invalid||J.value.execute()}const{humanizeByteSize:Ie,fileChecksum:Re,addAttachment:Le,uploadError:De,uploadFile:Me,truncateFilename:Pe}=ot();async function ze(q){const w=q.target.files[0],x={filename:w.name,byteSize:w.size,contentType:w.type,organization_id:s.state.portalSettings.organizationId,uploading:!0,signedId:null};try{if(!w)return;if(w.size>2e8)throw"File is too big. The size limit is "+Ie(2e8)+".";p.value.push(x),p.value[le(x)].checksum=await Re(w);const A=await Le(x);if(De.value||!A)throw`Error uploading file ${x.filename}`;await Me(A,w);const j=le(x);j!==-1&&(p.value[j]={...p.value[j],uploading:!1,signedId:A.signedId})}catch(A){G({display:!0,message:A,type:"error"}),pe(le(x))}finally{u.value.value=""}}function pe(q){q!==-1&&p.value.splice(q,1)}function le(q){return p.value.findIndex(h=>h.filename===q.filename&&h.byteSize===q.byteSize)}return(q,h)=>(o(),k("article",Et,[a("div",Ut,[a("div",qt,g($.value.formTitle),1),a("div",It,[L(g($.value.formMessage)+" ",1),$.value.includeEmail?(o(),k("span",Rt,[L(" You may also send tickets directly to "),a("a",{href:`mailto:${$.value.incomingEmail}`,class:"tw-text-black tw-underline"},g($.value.incomingEmail),9,Lt)])):U("",!0)])]),Dt,f(Ce,{ref_key:"form",ref:M,class:"tw-flex tw-flex-col tw-p-4 sm:tw-p-6",onSubmit:oe(O,["prevent"])},{default:T(()=>[f(R(Ge),{ref_key:"invisibleRecaptcha",ref:J,size:"invisible",sitekey:i.value,onVerify:re},null,8,["sitekey"]),d.value?U("",!0):(o(),b(F,{key:0,modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=w=>t.value=w),"error-messages":te.value,label:"Contact Email (required)",class:"pb-6 tw-pb-2"},null,8,["modelValue","error-messages"])),f(F,{modelValue:r.value,"onUpdate:modelValue":[h[1]||(h[1]=w=>r.value=w),h[2]||(h[2]=w=>R(n).summary.$touch())],"error-messages":se.value,counter:255,label:"Summary (required)",class:"tw-pb-2"},null,8,["modelValue","error-messages"]),f(me,{modelValue:c.value,"onUpdate:modelValue":[h[3]||(h[3]=w=>c.value=w),h[4]||(h[4]=w=>R(n).description.$touch())],"error-messages":ae.value,counter:2e3,label:"Description (required)",class:"tw-pb-2"},null,8,["modelValue","error-messages"]),$.value.includeCategory?(o(),b(Ae,{key:1,modelValue:m.value,"onUpdate:modelValue":h[5]||(h[5]=w=>m.value=w),items:C.value,"item-title":"name","item-value":"id","error-messages":I.value,label:V.value,class:"tw-pb-2"},null,8,["modelValue","items","error-messages","label"])):U("",!0),(o(!0),k(B,null,X(E.value,(w,x)=>(o(),k("div",{key:w.customAttributeId,class:"tw-pb-2"},[w.customAttributeType==="list"?(o(),b(St,{key:0,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A},null,8,["modelValue","onUpdate:modelValue"])):U("",!0),w.customAttributeType==="text_area"?(o(),b(Tt,{key:1,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A},null,8,["modelValue","onUpdate:modelValue"])):U("",!0),w.customAttributeType==="text_field"?(o(),b(he,{key:2,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A},null,8,["modelValue","onUpdate:modelValue"])):U("",!0),w.customAttributeType==="number"?(o(),b(he,{key:3,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A,"is-number":""},null,8,["modelValue","onUpdate:modelValue"])):U("",!0),w.customAttributeType==="date"?(o(),b(Ct,{key:4,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A},null,8,["modelValue","onUpdate:modelValue"])):U("",!0),w.customAttributeType==="phone"?(o(),b(At,{key:5,modelValue:E.value[x],"onUpdate:modelValue":A=>E.value[x]=A},null,8,["modelValue","onUpdate:modelValue"])):U("",!0)]))),128)),S.value?(o(),k("div",Mt,[$e(a("input",{ref_key:"fileInput",ref:u,type:"file",onChange:ze},null,544),[[Oe,!1]]),f(Z,{icon:"mdi-paperclip",text:"Attach a file",class:"mb-4 mt-3",onClick:h[6]||(h[6]=oe(w=>q.$refs.fileInput.click(),["prevent"]))}),(o(!0),k(B,null,X(p.value,(w,x)=>(o(),k("div",{key:w.filename,class:"attachment-card tw-b-0 tw-my-2 tw-block tw-w-80 tw-bg-earl-40 tw-px-3 tw-py-2"},[w.uploading?(o(),b(Ve,{key:0,size:18,width:2,indeterminate:"",class:"tw-mr-2"})):(o(),b(ie,{key:1,class:"tw-mr-1"},{default:T(()=>[L("mdi-check")]),_:1})),L(" "+g(R(Pe)(w.filename,28))+" ",1),f(ue,{class:"remove-attachment tw-float-right tw-p-0",height:20,variant:"outlined",icon:"mdi-close",onClick:A=>pe(x)},null,8,["onClick"])]))),128))])):U("",!0),a("div",Pt,[f(Z,{"button-type":"primary",text:"Submit",type:"submit",loading:_.value,disabled:_.value||K.value},null,8,["loading","disabled"])])]),_:1},512)]))}},zt={class:"tw-flex tw-h-40 tw-w-full tw-items-center tw-justify-center"},qe={__name:"LoadingSpinner",setup(e){const s=W(),t=v(()=>s.state.portalSettings),u=v(()=>r(t.value.theme));function r(c){return{blue:"#2099BD",red:"#E97472",orange:"#FF9E1B",grey:"#989A9C",green:"#6DA744",purple:"#75559F",indigo:"#1044AA",cyan:"#49A3AA"}[c]}return(c,m)=>(o(),k("div",zt,[f(Ve,{size:70,width:7,color:u.value,indeterminate:""},null,8,["color"])]))}};const Ot=e=>(xe("data-v-0c0926a6"),e=e(),Te(),e),Nt={class:"tw-w-full tw-rounded tw-border tw-bg-white tw-py-4 tw-shadow-portal sm:tw-p-6"},jt={key:1},Bt={class:"tw-my-1 tw-flex tw-justify-between tw-border-b tw-border-solid tw-px-4 sm:tw-border-0 sm:tw-px-0 lg:tw-flex-row"},Ft=["onClick"],Ht={class:"tw-w-full tw-text-sm tw-text-earl-1000",style:{padding:"0.75rem 1rem"}},Kt={class:"tw-flex tw-justify-between tw-pb-1 tw-text-xs"},Gt={class:"tw-truncate"},Yt={class:"tw-flex tw-truncate"},Wt={class:"tw-my-1 tw-line-clamp-1 tw-font-bold"},Jt={class:"tw-line-clamp-2"},Xt=["onClick"],Qt={class:"ticket-number tw-w-12"},Zt={class:"tw-font-bold"},es={class:"tw-w-24"},ts={class:"tw-w-24"},ss={key:0,class:"tw-my-3 tw-block tw-justify-center tw-text-earl-600"},as=Ot(()=>a("br",null,null,-1)),rs={key:1,class:"tw-text-earl-600"},ls={__name:"TicketList",setup(e){const s=We(),t=y(null),u=y([]),r=y("open"),c=y([{value:"open",title:"Open Tickets"},{value:"closed",title:"Closed Tickets"}]),m=y(!0),p=y(!1),{isMobile:_}=de(),d=[{title:"ID",key:"id",class:"fixed-padding header"},{title:"Summary",key:"summary"},{title:"Description",key:"description"},{title:"Assignee",key:"assignee",class:"fixed-padding header"},{title:"Updated",key:"updatedAt"}];ee(l);async function l(){p.value=!0,u.value=await bt(r.value),p.value=!1}function n($){let S="fixed-padding tw-cursor-pointer";return S+=$%2===0?" tw-b-0":" tw-bg-earl-50",S}function i($,S){return $.length<=S?$:$.slice(0,S)+"..."}function C($){s.push({path:`ticket/${$.id}`})}return($,S)=>(o(),k("div",Nt,[p.value?(o(),b(qe,{key:0})):(o(),k("div",jt,[f(dt,{"hide-default-header":R(_),headers:d,items:u.value,"items-per-page":15,search:t.value,class:"tickets-data-table"},{top:T(()=>[a("div",Bt,[!R(_)||!t.value&&m.value?(o(),b(pt,{key:0,modelValue:r.value,"onUpdate:modelValue":[S[0]||(S[0]=V=>r.value=V),l],items:c.value,class:"tw-w-32 tw-justify-center tw-text-xl tw-font-bold tw-text-earl-600"},null,8,["modelValue","items"])):U("",!0),R(_)?(o(),b(F,{key:1,modelValue:t.value,"onUpdate:modelValue":S[1]||(S[1]=V=>t.value=V),placeholder:"Search...",class:ne(["search tw-w-full tw-flex-initial tw-border-earl-200 tw-pb-2 tw-text-sm",{closed:m.value&&!t.value}]),clearable:"","hide-details":"",onFocus:S[2]||(S[2]=V=>m.value=!1),onBlur:S[3]||(S[3]=V=>m.value=!0)},{"prepend-inner":T(()=>[f(ie,{color:m.value?"#434648":"#2099BD"},{default:T(()=>[L("mdi-magnify")]),_:1},8,["color"])]),_:1},8,["modelValue","class"])):(o(),b(F,{key:2,modelValue:t.value,"onUpdate:modelValue":S[4]||(S[4]=V=>t.value=V),placeholder:"Search...",class:"tw-w-3/6 tw-flex-initial tw-border-earl-200 tw-px-4 tw-text-sm","prepend-inner-icon":"mdi-magnify",clearable:""},null,8,["modelValue"]))])]),item:T(({item:V,index:K})=>[R(_)?(o(),k("tr",{key:0,class:"tw-cursor-pointer tw-border-b tw-border-solid tw-border-earl-200",onClick:G=>C(V)},[a("td",Ht,[a("div",Kt,[a("div",Gt,g(V.assignee),1),a("div",Yt,[a("span",null,g(V.updatedAt),1)])]),a("div",Wt,g(V.summary),1),a("div",Jt,g(V.description),1)])],8,Ft)):(o(),k("tr",{key:1,class:ne(n(K)),onClick:G=>C(V)},[a("td",Qt,g(V.id),1),a("td",Zt,g(i(V.summary,52)),1),a("td",null,g(i(V.description,52)),1),a("td",es,g(V.assignee),1),a("td",ts,g(V.updatedAt),1)],10,Xt))]),"no-data":T(()=>[r.value==="open"?(o(),k("span",ss,[L("You have no open tickets at the moment. "),as,L(" Press submit a ticket if you need to request something from IT or Maintenance. ")])):(o(),k("span",rs,"No closed tickets found"))]),_:1},8,["hide-default-header","items","search"])])),R(_)?(o(),b(ue,{key:2,to:"/ticket",class:"tw-mb-10 tw-mr-10",icon:"mdi-plus",position:"fixed",location:"bottom right",variant:"elevated",color:"primary",height:"48",width:"48"})):U("",!0)]))}},os=ce(ls,[["__scopeId","data-v-0c0926a6"]]),ns={class:"tw-w-full"},is={class:"tw-flex tw-flex-col tw-items-center tw-justify-center lg:tw-flex-row lg:tw-items-start"},us={key:0,class:"tw-mx-4 tw-mb-4 tw-w-85 tw-flex-none sm:tw-w-full sm:tw-max-w-176 sm:tw-flex-auto lg:tw-w-85 lg:tw-flex-none"},cs={class:"tw-mx-4 tw-mb-4 tw-w-85 tw-flex-none sm:tw-w-full sm:tw-max-w-176 sm:tw-flex-auto"},ds={__name:"PortalWrapper",props:{announcement:{type:String,default:""}},setup(e){const t=y(e.announcement);return(u,r)=>(o(),k("section",ns,[a("div",is,[t.value?(o(),k("div",us,[f(Ye,{announcement:t.value},null,8,["announcement"])])):U("",!0),a("div",cs,[Ne(u.$slots,"default")])])]))}},ge={__name:"LandingPage",setup(e){const s=W(),t=v(()=>s.state.portalSettings),u=v(()=>s.state.currentUser);return(r,c)=>(o(),b(ds,{announcement:t.value.pageAnnouncements},{default:T(()=>[u.value?(o(),b(os,{key:0})):(o(),b(Ue,{key:1}))]),_:1},8,["announcement"]))}},ms={class:"tw-flex tw-flex-col tw-items-center tw-justify-center lg:tw-flex-row lg:tw-items-start"},ps={class:"tw-mx-4 tw-mb-4 tw-w-85 tw-flex-none sm:tw-w-full sm:tw-max-w-176 sm:tw-flex-auto"},ws={__name:"CreateTicket",setup(e){return(s,t)=>(o(),k("div",ms,[a("div",ps,[f(Ue)])]))}};const vs={key:1,class:"container-bg tw-z-10 tw-flex tw-w-full tw-flex-row tw-items-center tw-justify-between tw-py-3"},_s={class:"tw-flex tw-items-center"},fs={class:"tw-line-clamp-2 tw-text-lg tw-font-bold"},ys={class:"lg:tw-hidden"},hs={class:"container-bg tw-z-10 tw-w-full tw-overflow-auto tw-py-3"},gs={__name:"TicketHistory",props:{ticket:{type:Object,required:!0},onChangeTicketStatus:{type:Function,required:!0}},emits:["update:show-details-modal"],setup(e,{emit:s}){const t=W(),u=y(""),r=y([]),c=y(64),m=y(!1),p=v(()=>t.state.currentUser),_=v(()=>t.state.portalSettings),d=y(null),l=y(null),n={newEntry:{required:N(()=>u.value.trim().length===0),maxLength:Q(1e5)}},i=H(n,{newEntry:u}),C=e,$=v(()=>`${C.ticket.status=="closed"?"Reopen":"Close"} Ticket`),S=v(()=>{const I=[];return!i.value||!i.value.newEntry.$dirty||(i.value.newEntry.required.$invalid?I.push("The response can't be empty."):i.value.newEntry.maxLength.$invalid&&I.push("The response should be less than 100,000 characters.")),I}),V=v(()=>`height: calc(var(--vh, 1vh) * 100 - ${c.value}px);`),K=async()=>{m.value=!0,r.value=await Vt(C.ticket.id),m.value=!1};ee(K);const G=async()=>{if(i.value.newEntry.$touch(),!i.value.newEntry.$invalid){const I=await xt(C.ticket.id,{ticket_comment:{body:u.value,creator_id:null,ticket_id:C.ticket.id}}),M={display:!0,type:"success",message:"Your comment has been created."};I.errors?(M.type="error",M.message=I.errors):(l.value.reset(),i.value.newEntry.$reset(),u.value="",await K(),d.value.scrollTop=d.value.scrollHeight),t.dispatch("showSnackbar",M)}},E=async()=>{try{await C.onChangeTicketStatus()}catch{t.dispatch("showSnackbar",{display:!0,type:"error",message:"There was an error updating the ticket status. Please try again."})}},J=s,te=()=>{J("update:show-details-modal",!0)},{isMobile:se}=de(),ae=()=>{se.value||(c.value=d.value.getBoundingClientRect().top+25)};return(I,M)=>{const re=be("router-link");return $e((o(),k("div",{class:"tw-relative tw-flex tw-w-full tw-flex-col tw-justify-between",style:we(V.value)},[m.value?(o(),b(qe,{key:0})):(o(),k("div",vs,[a("div",_s,[f(re,{class:"tw-mr-4 tw-cursor-pointer",to:"/"},{default:T(()=>[f(ie,null,{default:T(()=>[L("mdi-arrow-left")]),_:1})]),_:1}),a("div",fs,g(e.ticket.summary),1)]),a("div",ys,[f(Se,{location:"bottom left"},{activator:T(({props:O})=>[f(ue,ke({icon:"mdi-dots-vertical"},O),null,16)]),default:T(()=>[f(ct,null,{default:T(()=>[f(fe,{onClick:te},{default:T(()=>[f(ye,null,{default:T(()=>[L("Ticket Details")]),_:1})]),_:1}),f(fe,{onClick:E},{default:T(()=>[f(ye,null,{default:T(()=>[L(g($.value),1)]),_:1})]),_:1})]),_:1})]),_:1})])])),a("div",{ref_key:"ticketHistoryElem",ref:d,class:ne("tw-absolute tw-w-full tw-overflow-y-auto tw-py-14"),style:we(V.value)},[f(ve,{entry:e.ticket,theme:_.value.theme,"portal-user-uid":p.value.uid},null,8,["entry","theme","portal-user-uid"]),(o(!0),k(B,null,X(r.value,O=>(o(),b(ve,{key:O.id,entry:O,theme:_.value.theme,"portal-user-uid":p.value.uid},null,8,["entry","theme","portal-user-uid"]))),128))],4),a("div",hs,[f(Ce,{ref_key:"form",ref:l,class:"tw-flex tw-flex-row tw-items-end",onSubmit:oe(G,["prevent"])},{default:T(()=>[f(me,{modelValue:u.value,"onUpdate:modelValue":M[0]||(M[0]=O=>u.value=O),"error-messages":S.value,placeholder:"Type a response or question","bg-color":"white","auto-grow":"",rows:"1",onKeydown:R(i).newEntry.$touch},null,8,["modelValue","error-messages","onKeydown"]),f(Z,{"button-type":"primary",icon:"mdi-send","icon-size":"default",text:"Send","hide-text-on-mobile":!0,class:"tw-mb-1.5 tw-ml-2","min-width":"4rem","min-height":"2.5rem",type:"submit",disabled:R(i).newEntry.$invalid},null,8,["disabled"])]),_:1},512)])],4)),[[nt,ae]])}}},bs=ce(gs,[["__scopeId","data-v-b044f1f0"]]);const z=e=>(xe("data-v-08960639"),e=e(),Te(),e),ks={class:"tw-w-full tw-rounded tw-border tw-bg-white tw-p-4 tw-shadow-portal sm:tw-p-6"},$s={class:"tw-mb-5 tw-flex tw-w-full tw-flex-row tw-items-center tw-justify-between"},Vs=z(()=>a("div",{class:"tw-text-xl tw-font-bold"},"Ticket Details",-1)),xs={class:"tw-flex tw-flex-col"},Ts=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Assignee")],-1)),Ss={class:"tw-mb-3"},As={class:"tw-break-normal tw-capitalize"},Cs=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Category")],-1)),Es={class:"tw-mb-3"},Us={class:"tw-break-normal tw-capitalize"},qs=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Status")],-1)),Is={class:"tw-mb-3"},Rs={class:"tw-break-normal tw-capitalize"},Ls=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Created")],-1)),Ds={class:"tw-mb-3"},Ms={class:"tw-break-normal"},Ps={class:"ticket-property-title"},zs={class:"tw-mb-3"},Os={class:"tw-break-normal tw-capitalize"},Ns={class:"tw-flex tw-flex-col"},js=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Assignee")],-1)),Bs={class:"tw-mb-3"},Fs={class:"tw-break-normal tw-capitalize"},Hs=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Category")],-1)),Ks={class:"tw-mb-3"},Gs={class:"tw-break-normal tw-capitalize"},Ys=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Status")],-1)),Ws={class:"tw-mb-3"},Js={class:"tw-break-normal tw-capitalize"},Xs=z(()=>a("tr",null,[a("td",{class:"ticket-property-title"},"Created")],-1)),Qs={class:"tw-mb-3"},Zs={class:"tw-break-normal"},ea={class:"ticket-property-title"},ta={class:"tw-mb-3"},sa={class:"tw-break-normal tw-capitalize"},aa={__name:"TicketDetails",props:{ticket:{type:Object,required:!0},onChangeTicketStatus:{type:Function,required:!0},showDetailsModal:{type:Boolean,default:!1}},emits:["update:show-details-modal"],setup(e,{emit:s}){const t=e,u=W(),{isMobile:r}=de(),c=v(()=>`${t.ticket.status=="closed"?"Reopen":"Close"} ticket`),m=y(!1),p=s;je(()=>{m.value=t.showDetailsModal});const _=()=>{m.value=!1,p("update:show-details-modal",!1)},d=async()=>{try{await t.onChangeTicketStatus(!r.value)}catch{const n={display:!0,message:"An error occurred while updating the ticket. Please try again.",type:"error"};await u.dispatch("showSnackbar",n)}};return(l,n)=>(o(),k("div",ks,[a("div",$s,[Vs,f(Z,{"button-type":"primary",text:c.value,type:"submit",onClick:d},null,8,["text"])]),a("table",xs,[Ts,a("tr",Ss,[a("td",As,g(e.ticket.assignee),1)]),Cs,a("tr",Es,[a("td",Us,g(e.ticket.details.ticketCategory.name||"Unspecified"),1)]),qs,a("tr",Is,[a("td",Rs,g(e.ticket.status),1)]),Ls,a("tr",Ds,[a("td",Ms,g(e.ticket.details.customDates.createdAt),1)]),(o(!0),k(B,null,X(e.ticket.customValues,i=>(o(),k(B,{key:i==null?void 0:i.id},[a("tr",null,[a("td",Ps,g(i.name),1)]),a("tr",zs,[a("td",Os,g(i.value||"Unspecified"),1)])],64))),128))]),f(Je,{"is-showing-dialog":m.value,"onUpdate:isShowingDialog":n[0]||(n[0]=i=>m.value=i),title:"Ticket Details",onCloseDialog:_},{content:T(()=>[f(Z,{"button-type":"primary",text:c.value,class:"mb-4 mt-3",type:"submit",onClick:d},null,8,["text"]),a("table",Ns,[js,a("tr",Bs,[a("td",Fs,g(e.ticket.assignee),1)]),Hs,a("tr",Ks,[a("td",Gs,g(e.ticket.details.ticketCategory.name||"Unspecified"),1)]),Ys,a("tr",Ws,[a("td",Js,g(e.ticket.status),1)]),Xs,a("tr",Qs,[a("td",Zs,g(e.ticket.details.customDates.createdAt),1)]),(o(!0),k(B,null,X(e.ticket.customValues,i=>(o(),k(B,{key:i==null?void 0:i.id},[a("tr",null,[a("td",ea,g(i.name),1)]),a("tr",ta,[a("td",sa,g(i.value||"Unspecified"),1)])],64))),128))])]),_:1},8,["is-showing-dialog"])]))}},ra=ce(aa,[["__scopeId","data-v-08960639"]]),la={class:"tw-w-full"},oa={class:"tw-flex tw-flex-col tw-items-center tw-justify-center sm:tw-flex-row sm:tw-items-start"},na={class:"tw-mx-4 tw-w-full tw-flex-none tw-border-t tw-bg-white tw-px-4 tw-shadow-portal sm:tw-rounded sm:tw-border sm:tw-p-6 lg:tw-max-w-152 lg:tw-flex-auto"},ia={class:"tw-mx-4 tw-hidden tw-w-80 tw-flex-none lg:tw-block"},ua={__name:"PortalTicket",setup(e){const s=W(),u=Xe().params.ticketId,r=y(null),c=y(!1),m=v(()=>{const _=[];let d;for(let l=0;l<r.value.customValues.length;l++)d=r.value.customValues[l],_.push({id:d.id,value:d.value,ticket_id:d.ticket.id,custom_attribute_id:d.customAttribute.id,custom_attribute_type:d.customAttribute.type});return _});ee(async()=>{r.value=await kt(u)});async function p(_=!0){const d=r.value.status=="closed"?"open":"closed",l=await $t({ticket:{number:r.value.id,description:r.value.description,status:d,summary:r.value.summary,custom_values:m.value}}),n={display:!0,type:"success",message:"Your ticket has been updated."};l.errors?(n.type="error",n.message=l.errors):r.value.status=d,_&&await s.dispatch("showSnackbar",n)}return(_,d)=>(o(),k("section",la,[a("div",oa,[a("div",na,[r.value?(o(),b(bs,{key:0,ticket:r.value,"on-change-ticket-status":p,"onUpdate:showDetailsModal":d[0]||(d[0]=l=>c.value=l)},null,8,["ticket"])):U("",!0)]),a("div",ia,[r.value?(o(),b(ra,{key:0,ticket:r.value,"on-change-ticket-status":p,"show-details-modal":c.value,"onUpdate:showDetailsModal":d[1]||(d[1]=l=>c.value=l)},null,8,["ticket","show-details-modal"])):U("",!0)])])]))}};function ca(){const e=Qe({history:Ze("/portal/"),routes:[{path:"/ticket",component:ws,name:"CreateTicket",meta:{requiresAuth:!0}},{path:"/ticket/:ticketId",component:ua,name:"Ticket",meta:{requiresAuth:!0}},{path:"/",component:ge,name:"Landing"},{path:"/:catchAll(.*)",component:ge}]});return e.beforeEach((s,t,u)=>{const{currentUser:r}=Ee.state.portalSettings;s.matched.some(c=>c.meta.requiresAuth)?r?u():u({name:"Landing"}):u()}),e.afterEach((s,t)=>{wt.pageView(t)}),e}document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("portal-vue"),s=e.getAttribute("portal-settings-id"),t=e.getAttribute("grecaptcha-site-key"),u=e.getAttribute("portal-service-interruption"),r=He(Ee);await r.dispatch("setPortalData",s),await r.dispatch("setGRecaptchaSiteKey",t),await r.dispatch("setPortalServiceInterruption",u);const c=ca();Be(_t).use(c).use(r).use(Fe).mount("#portal-vue")});
//# sourceMappingURL=portal-0ce7c72d.js.map
